# 实施计划

- [x] 1. 项目初始化和基础设施





  - 创建项目目录结构
  - 配置 requirements.txt 和开发依赖
  - 设置配置管理模块（config.py）
  - _需求: 7.1, 7.2_
-

- [x] 2. 数据库层实现




  - 实现数据库连接管理（db.py）
  - 创建 docs 表和 docs_fts 虚拟表
  - 实现数据库初始化函数
  - _需求: 5.1, 5.2_

- [x] 2.1 编写数据库初始化的示例测试







  - 测试 docs 表创建
  - 测试 docs_fts 虚拟表创建
  - _需求: 5.1, 5.2_

- [x] 3. Markdown 解析和索引器





  - 实现 Markdown 文件遍历功能
  - 实现 frontmatter 解析和标题提取
  - 实现文档内容提取和摘要生成
  - 实现单文件索引函数（支持 UPSERT）
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 3.1 编写属性测试：Frontmatter 标题提取






  - **属性 5: Frontmatter 标题提取**
  - **验证需求: 2.1**
-

- [x] 3.2 编写属性测试：文档摘要长度限制





  - **属性 6: 文档摘要长度限制**
  - **验证需求: 2.5**

- [x] 3.3 编写属性测试：索引幂等性





  - **属性 10: 索引幂等性**
  - **验证需求: 5.5**

- [x] 4. 全量索引功能





  - 实现全量重建索引函数
  - 实现索引清空逻辑
  - 创建初始化脚本（scripts/init_db.py）
  - _需求: 5.3, 5.4_
-

- [x] 4.1 编写属性测试：全量重建清空旧数据





  - **属性 11: 全量重建清空旧数据**
  - **验证需求: 5.4**

- [x] 5. 文件监控服务





  - 实现 watchdog 事件处理器
  - 处理文件创建、修改、删除事件
  - 实现文件类型过滤（只处理 .md 文件）
  - 实现监听器启动函数
  - _需求: 3.1, 3.2, 3.3, 3.5_

- [x] 5.1 编写属性测试：索引与文件系统同步






  - **属性 7: 索引与文件系统同步**
  - **验证需求: 3.1, 3.2, 3.3**
-

- [x] 5.2 编写属性测试：非 Markdown 文件被忽略





  - **属性 8: 非 Markdown 文件被忽略**
  - **验证需求: 3.5**
-

- [x] 6. 搜索服务实现




  - 实现 FTS5 全文搜索查询
  - 实现 BM25 排序
  - 实现 snippet 高亮生成
  - 实现分页逻辑
  - 实现搜索结果计数
  - _需求: 1.1, 1.2, 1.3, 1.5_
-

- [x] 6.1 编写属性测试：搜索结果包含高亮关键词





  - **属性 1: 搜索结果包含高亮关键词**
  - **验证需求: 1.3**
-

- [x] 6.2 编写属性测试：搜索结果按相关性排序





  - **属性 2: 搜索结果按相关性排序**
  - **验证需求: 1.2**
-

- [x] 6.3 编写属性测试：分页返回正确数量





  - **属性 4: 分页返回正确数量**
  - **验证需求: 1.5**

- [x] 7. 文档服务实现




  - 实现根据 ID 获取文档功能
  - 实现 Markdown 到 HTML 转换
  - 支持代码块和表格扩展
  - _需求: 4.1, 4.2, 4.5_
-

- [x] 7.1 编写属性测试：文档检索返回 HTML





  - **属性 9: 文档检索返回 HTML**
  - **验证需求: 4.2**

- [x] 7.2 编写属性测试：Markdown 扩展语法支持






  - **属性 19: Markdown 扩展语法支持**
  - **验证需求: 4.5**

- [x] 8. Pydantic 数据模型




  - 定义 SearchResult 模型
  - 定义 SearchResponse 模型
  - 定义 Document 模型
  - 定义 ErrorResponse 模型
  - _需求: 9.1_
-

- [x] 9. API 路由实现




  - 实现 GET /search 端点
  - 实现查询参数验证（非空、limit、offset）
  - 实现 GET /docs/{doc_id} 端点
  - 实现错误处理（404、422）
  - _需求: 1.4, 4.3, 4.4, 9.3_

- [x] 9.1 编写属性测试：空查询被拒绝






  - **属性 3: 空查询被拒绝**
  - **验证需求: 1.4**

- [x] 9.2 编写属性测试：搜索响应包含必需字段






  - **属性 12: 搜索响应包含必需字段**
  - **验证需求: 6.3**


- [x] 9.3 编写属性测试：API 返回 JSON 格式








  - **属性 17: API 返回 JSON 格式**
  - **验证需求: 9.1**
-

- [x] 9.4 编写属性测试：无效参数返回 4xx





  - **属性 18: 无效参数返回 4xx**
  - **验证需求: 9.3**
-

- [x] 10. FastAPI 应用入口



  - 创建 FastAPI 应用实例
  - 配置启动事件（初始化数据库、启动监听器）
  - 配置关闭事件（清理资源）
  - 注册 API 路由
  - _需求: 9.5_
-

- [x] 10.1 编写配置加载的示例测试





  - 测试从配置文件读取 MD_ROOT
  - 测试从配置文件读取 DB_PATH
  - _需求: 7.1, 7.2_
-

- [x] 11. 中文搜索支持













  - 验证 FTS5 使用 unicode61 分词器
  - 测试中文关键词搜索
  - 测试中英文混合搜索
  - 测试中文高亮显示
  - _需求: 8.1, 8.2, 8.3, 8.4_
-

- [x] 11.1 编写属性测试：中文关键词搜索





  - **属性 14: 中文关键词搜索**
  - **验证需求: 8.2**

- [x] 11.2 编写属性测试：中英文混合搜索






  - **属性 15: 中英文混合搜索**
  - **验证需求: 8.3**
-

- [x] 11.3 编写属性测试：中文高亮正确性





  - **属性 16: 中文高亮正确性**
  - **验证需求: 8.4**

- [x] 11.4 编写属性测试：音调符号标准化






  - **属性 20: 音调符号标准化**
  - **验证需求: 8.5**
-

- [x] 12. Web 界面实现




  - 创建 HTML 模板（base.html, search.html, doc.html）
  - 实现搜索页面路由（GET /）
  - 添加静态文件支持（CSS、JS）
  - 实现搜索结果展示
  - _需求: 6.1, 6.3, 6.5_

- [x] 12.1 编写搜索页面的示例测试







  - 测试访问根路径返回搜索页面
  - _需求: 6.1_
-
-

- [x] 13. 错误处理和日志









  - 实现统一错误处理中间件
  - 配置日志记录（INFO、WARNING、ERROR）
  - 实现错误响应格式化
  - 添加访问日志
  - _需求: 10.2_
-

- [x] 13.1 编写属性测试：日志记录





  - **验证需求: 10.2**
--

- [x] 14. 配置管理增强





- [ ] 14. 配置管理增强



  - 实现配置验证（路径存在性检查）
  - 实现配置错误提示
  - 添加环境变量支持
  - 创建 .env.example 文件
  - _需求: 7.3, 7.5_
-

- [x] 14.1 编写属性测试：配置重载生效





  - **属性 13: 配置重载生效**
  - **验证需求: 7.4**
-

- [x] 15. 安全加固









  - 实现查询字符串长度限制
  - 实现路径遍历防护
  - 配置 CORS 策略
  - 设置数据库文件权限
  - _需求: 安全考虑章节_
-

- [x] 16. 部署准备




  - 创建 README.md 文档
  - 编写部署说明
  - 创建 systemd 服务文件示例
  - 创建 Nginx 配置示例
  - _需求: 10.1, 10.5_
-

- [x] 17. 检查点 - 确保所有测试通过




  - 确保所有测试通过，如有问题请询问用户
